
{
  "entities": {
    "Farm": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Farm",
      "type": "object",
      "description": "Represents a farm managed within the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Farm entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the farm."
        },
        "areaHectare": {
          "type": "number",
          "description": "Area of the farm in hectares."
        },
        "location": {
          "type": "object",
          "description": "Farm's location as a GeoPoint.",
          "properties": {
            "lat": { "type": "number" },
            "lon": { "type": "number" }
          }
        }
      },
      "required": ["id", "name", "areaHectare", "location"]
    },
    "SensorReading": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SensorReading",
      "type": "object",
      "description": "Represents a sensor reading taken on a farm.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SensorReading entity."
        },
        "farmId": {
          "type": "string",
          "description": "Reference to Farm where the reading was taken."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of the sensor reading.",
          "format": "date-time"
        },
        "N": { "type": "number", "description": "Nitrogen level." },
        "P": { "type": "number", "description": "Phosphorus level." },
        "K": { "type": "number", "description": "Potassium level." },
        "pH": { "type": "number", "description": "pH level." },
        "moisture": { "type": "number", "description": "Moisture level." },
        "temperature": { "type": "number", "description": "Temperature reading." },
        "humidity": { "type": "number", "description": "Humidity level." },
        "rainfall": { "type": "number", "description": "Rainfall amount." },
        "source": {
          "type": "string",
          "description": "Source of the sensor reading ('iot' or 'manual')."
        }
      },
      "required": [
        "id",
        "farmId",
        "timestamp",
        "N",
        "P",
        "K",
        "pH",
        "moisture",
        "temperature",
        "humidity",
        "rainfall",
        "source"
      ]
    },
    "Image": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Image",
      "type": "object",
      "description": "Represents an image uploaded to the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Image entity."
        },
        "farmId": {
          "type": "string",
          "description": "Reference to Farm the image belongs to."
        },
        "storagePath": {
          "type": "string",
          "description": "Path to the image in Firebase Storage."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of the image upload.",
          "format": "date-time"
        },
        "imageType": {
          "type": "string",
          "description": "Type of image ('leaf' or 'canopy')."
        }
      },
      "required": ["id", "farmId", "storagePath", "timestamp", "imageType"]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents a crop recommendation generated by the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Recommendation entity."
        },
        "farmId": {
          "type": "string",
          "description": "Reference to Farm the recommendation is for."
        },
        "inputFeatures": {
          "type": "object",
          "description": "Input features used to generate the recommendation."
        },
        "recommendedCrop": { "type": "string", "description": "Recommended crop." },
        "confidence": {
          "type": "number",
          "description": "Confidence level of the recommendation."
        },
        "modelVersion": {
          "type": "string",
          "description": "Version of the model used to generate the recommendation."
        },
        "shapSummary": {
          "type": "object",
          "description": "SHAP values for the recommendation."
        },
        "explanation": {
          "type": "string",
          "description": "Human-readable one-line explanation of the recommendation."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of the recommendation generation.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "farmId",
        "inputFeatures",
        "recommendedCrop",
        "confidence",
        "modelVersion",
        "explanation",
        "timestamp"
      ]
    },
    "DiseaseDetection": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DiseaseDetection",
      "type": "object",
      "description": "Represents a disease detection result.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DiseaseDetection entity."
        },
        "farmId": {
          "type": "string",
          "description": "Reference to Farm the detection is for."
        },
        "imageId": {
          "type": "string",
          "description": "Reference to Image the detection is based on."
        },
        "predictedDisease": { "type": "string", "description": "Predicted disease." },
        "confidence": {
          "type": "number",
          "description": "Confidence level of the disease detection."
        },
        "modelVersion": {
          "type": "string",
          "description": "Version of the model used for disease detection."
        },
        "explanation": {
          "type": "string",
          "description": "Explanation of the disease detection result."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of the disease detection.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "farmId",
        "imageId",
        "predictedDisease",
        "confidence",
        "modelVersion",
        "explanation",
        "timestamp"
      ]
    },
    "Model": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Model",
      "type": "object",
      "description": "Represents an ML model used by the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Model entity."
        },
        "type": {
          "type": "string",
          "description": "Type of model ('classifier', 'detector', 'regressor')."
        },
        "name": { "type": "string", "description": "Name of the model." },
        "version": { "type": "string", "description": "Version of the model." },
        "endpointUrl": {
          "type": "string",
          "description": "URL of the model's inference endpoint.",
          "format": "uri"
        },
        "metadata": {
          "type": "object",
          "description": "Metadata about the model."
        }
      },
      "required": ["id", "type", "name", "version", "endpointUrl"]
    }
  },
  "auth": {
    "providers": []
  },
  "firestore": {
    "structure": [
      {
        "path": "/farms/{farmId}",
        "schema": { "$ref": "#/entities/Farm" },
        "description": "Stores farm details."
      },
      {
        "path": "/sensor_readings/{readingId}",
        "schema": { "$ref": "#/entities/SensorReading" },
        "description": "Stores all sensor readings across all farms. Queries will be needed to filter by farmId."
      },
      {
        "path": "/images/{imageId}",
        "schema": { "$ref": "#/entities/Image" },
        "description": "Stores metadata for all images across all farms."
      },
      {
        "path": "/recommendations/{recId}",
        "schema": { "$ref": "#/entities/Recommendation" },
        "description": "Stores all crop recommendations across all farms."
      },
      {
        "path": "/disease_detections/{detId}",
        "schema": { "$ref": "#/entities/DiseaseDetection" },
        "description": "Stores all disease detections across all farms."
      },
      {
        "path": "/models/{modelId}",
        "schema": { "$ref": "#/entities/Model" },
        "description": "Stores information about the ML models used in the system."
      }
    ],
    "reasoning": "The Firestore structure uses top-level collections for each entity as requested. This denormalized approach is suitable for a system where data is accessed via specific IDs through backend services, rather than complex client-side queries. This aligns with the API-key gated architecture where Cloud Functions will be responsible for data fetching and association (e.g., retrieving all sensor readings for a given farmId)."
  }
}

    